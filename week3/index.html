<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Goodreads</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    .book {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .comments {
      margin-top: 0.5rem;
      padding-left: 1rem;
    }
    .comment-form {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
    }
    input {
      flex: 1;
      padding: 0.4rem;
    }
    button {
      padding: 0.4rem 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Mini Goodreads ðŸ“š</h1>
  <div id="book-list"></div>

  <script>
    const bookList = document.getElementById("book-list");

    // Fetch and display books
    async function loadBooks() {
      const res = await fetch("/api/books");
      const books = await res.json();
      bookList.innerHTML = "";

      books.forEach(book => {
        const div = document.createElement("div");
        div.className = "book";
        div.innerHTML = `
          <h2>${book.title}</h2>
          <p><em>by ${book.author}</em></p>
          <div class="comments">
            <strong>Comments:</strong>
            <ul>
              ${book.comments.map(c => `<li>${c}</li>`).join("") || "<li>No comments yet.</li>"}
            </ul>
          </div>
          <form class="comment-form" data-id="${book.id}">
            <input type="text" name="comment" placeholder="Add a comment..." required>
            <button type="submit">Post</button>
          </form>
        `;
        bookList.appendChild(div);
      });

      // Add form listeners
      document.querySelectorAll(".comment-form").forEach(form => {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const bookId = form.getAttribute("data-id");
          const comment = form.comment.value;
          form.comment.value = "";

          await fetch(`/api/books/${bookId}/comments`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ comment })
          });
          loadBooks(); // Refresh book list
        });
      });
    }

    loadBooks();
  </script>
</body>
</html>
